<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从Chrome渲染一帧的角度来做优化 | 浏览器</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/browser/assets/css/0.styles.a14fe33a.css" as="style"><link rel="preload" href="/browser/assets/js/app.9d8b2b9f.js" as="script"><link rel="preload" href="/browser/assets/js/2.c6ab72a1.js" as="script"><link rel="preload" href="/browser/assets/js/23.58ff0792.js" as="script"><link rel="prefetch" href="/browser/assets/js/10.585245e1.js"><link rel="prefetch" href="/browser/assets/js/11.5aae5444.js"><link rel="prefetch" href="/browser/assets/js/12.71269f1a.js"><link rel="prefetch" href="/browser/assets/js/13.0a7f30a4.js"><link rel="prefetch" href="/browser/assets/js/14.45a1a3a7.js"><link rel="prefetch" href="/browser/assets/js/15.ed81d5cf.js"><link rel="prefetch" href="/browser/assets/js/16.cc7e2e9b.js"><link rel="prefetch" href="/browser/assets/js/17.db4ea61b.js"><link rel="prefetch" href="/browser/assets/js/18.e3ae8c8b.js"><link rel="prefetch" href="/browser/assets/js/19.bfba4f3f.js"><link rel="prefetch" href="/browser/assets/js/20.c6b94b86.js"><link rel="prefetch" href="/browser/assets/js/21.1e59a022.js"><link rel="prefetch" href="/browser/assets/js/22.654197cf.js"><link rel="prefetch" href="/browser/assets/js/24.aea860a9.js"><link rel="prefetch" href="/browser/assets/js/25.26a87bae.js"><link rel="prefetch" href="/browser/assets/js/26.00a97756.js"><link rel="prefetch" href="/browser/assets/js/27.d3683b0a.js"><link rel="prefetch" href="/browser/assets/js/28.deb80b65.js"><link rel="prefetch" href="/browser/assets/js/29.9ad843c1.js"><link rel="prefetch" href="/browser/assets/js/3.2ac56f48.js"><link rel="prefetch" href="/browser/assets/js/30.707d3269.js"><link rel="prefetch" href="/browser/assets/js/31.3c38d117.js"><link rel="prefetch" href="/browser/assets/js/32.c449df23.js"><link rel="prefetch" href="/browser/assets/js/33.608e131b.js"><link rel="prefetch" href="/browser/assets/js/34.5d801168.js"><link rel="prefetch" href="/browser/assets/js/35.e0ef97a3.js"><link rel="prefetch" href="/browser/assets/js/36.12fa7af7.js"><link rel="prefetch" href="/browser/assets/js/37.b611c7e3.js"><link rel="prefetch" href="/browser/assets/js/38.5adc6f54.js"><link rel="prefetch" href="/browser/assets/js/39.eafb2e3f.js"><link rel="prefetch" href="/browser/assets/js/4.b7d0708f.js"><link rel="prefetch" href="/browser/assets/js/40.e1d0ac06.js"><link rel="prefetch" href="/browser/assets/js/41.bff30e89.js"><link rel="prefetch" href="/browser/assets/js/42.f57de2b4.js"><link rel="prefetch" href="/browser/assets/js/43.3eb2033e.js"><link rel="prefetch" href="/browser/assets/js/44.7049f3ae.js"><link rel="prefetch" href="/browser/assets/js/45.560dd0fe.js"><link rel="prefetch" href="/browser/assets/js/46.61f9c03b.js"><link rel="prefetch" href="/browser/assets/js/47.343cd03f.js"><link rel="prefetch" href="/browser/assets/js/48.6eaca372.js"><link rel="prefetch" href="/browser/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/browser/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/browser/assets/js/7.8a5eaf01.js"><link rel="prefetch" href="/browser/assets/js/8.c4154854.js"><link rel="prefetch" href="/browser/assets/js/9.400f3a74.js">
    <link rel="stylesheet" href="/browser/assets/css/0.styles.a14fe33a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/browser/" class="home-link router-link-active"><!----> <span class="site-name">浏览器</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/browser/" class="nav-link">
  html
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/browser/" class="nav-link">
  html
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/browser/componentDocs/Chrome架构.html" class="sidebar-link">Chrome 架构</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 网络.html" class="sidebar-link">输入URL到加载经历了什么 --- 网络</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 解析.html" class="sidebar-link">输入URL到加载经历了什么 --- 解析</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 渲染.html" class="sidebar-link">输入URL到加载经历了什么 --- 渲染</a></li><li><a href="/browser/componentDocs/同一站点.html" class="sidebar-link">同一站点(输入URL网络篇补充)</a></li><li><a href="/browser/componentDocs/回流.html" class="sidebar-link">重排、重绘和合成</a></li><li><a href="/browser/componentDocs/阻塞.html" class="sidebar-link">从渲染流水线看html、css、JavaScript的阻塞</a></li><li><a href="/browser/componentDocs/defer、async.html" class="sidebar-link">defer、async（阻塞章节优化JavaScript点）</a></li><li><a href="/browser/componentDocs/DOM树构建过程.html" class="sidebar-link">DOM树构建过程</a></li><li><a href="/browser/componentDocs/浏览器缓存.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/browser/componentDocs/浏览器页面如何工作.html" class="sidebar-link">浏览器页面如何工作</a></li><li><a href="/browser/componentDocs/页面生命周期.html" class="sidebar-link">页面生命周期</a></li><li><a href="/browser/componentDocs/跨域解决.html" class="sidebar-link">跨域解决方案</a></li><li><a href="/browser/componentDocs/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/browser/componentDocs/内存泄露.html" class="sidebar-link">内存泄露</a></li><li><a href="/browser/componentDocs/前端存储.html" class="sidebar-link">前端存储</a></li><li><a href="/browser/componentDocs/存储超过限制.html" class="sidebar-link">存储超过限制</a></li><li><a href="/browser/componentDocs/识别浏览器类型.html" class="sidebar-link">识别浏览器类型</a></li><li><a href="/browser/componentDocs/外部资源的加载事件.html" class="sidebar-link">资源加载</a></li><li><a href="/browser/componentDocs/Chrome开发者工具.html" class="sidebar-link">Chrome开发者工具</a></li><li><a href="/browser/componentDocs/网络面板.html" class="sidebar-link">网络面板</a></li><li><a href="/browser/componentDocs/首屏优化.html" class="sidebar-link">首屏加载</a></li><li><a href="/browser/componentDocs/CSS动画和JS动画.html" class="sidebar-link">CSS动画和JavaScript动画</a></li><li><a href="/browser/componentDocs/CDN.html" class="sidebar-link">CDN</a></li><li><a href="/browser/componentDocs/资源优化.html" class="sidebar-link">资源优化</a></li><li><a href="/browser/componentDocs/浏览器安全.html" class="sidebar-link">浏览器安全</a></li><li><a href="/browser/componentDocs/XSS攻击.html" class="sidebar-link">XSS 攻击</a></li><li><a href="/browser/componentDocs/CSRF 攻击.html" class="sidebar-link">CSRF 攻击</a></li><li><a href="/browser/componentDocs/浏览器内核与引擎.html" class="sidebar-link">浏览器内核与引擎</a></li><li><a href="/browser/componentDocs/V8执行原理和优化策略.html" class="sidebar-link">JavaScriot(V8) 执行原理</a></li><li><a href="/browser/componentDocs/V8优化小知识点.html" class="sidebar-link">V8优化小知识点</a></li><li><a href="/browser/componentDocs/v8对数组的优化.html" class="sidebar-link">V8数组的动态扩容以及对数组优化</a></li><li><a href="/browser/componentDocs/从Chrome渲染一帧的角度来做优化.html" class="active sidebar-link">从Chrome渲染一帧的角度来做优化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/componentDocs/Chrome的Audits面板.html" class="sidebar-link">Chrome的Audits面板</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从chrome渲染一帧的角度来做优化"><a href="#从chrome渲染一帧的角度来做优化" class="header-anchor">#</a> 从Chrome渲染一帧的角度来做优化</h1> <p>Chrome渲染一帧的，也就是从渲染流水线的角度来看。如何能够让页面更快的显示和响应。</p> <h3 id="三个重要的阶段-加载阶段、交互阶段和关闭阶段"><a href="#三个重要的阶段-加载阶段、交互阶段和关闭阶段" class="header-anchor">#</a> 三个重要的阶段(加载阶段、交互阶段和关闭阶段)</h3> <ul><li>加载阶段：从请求到渲染出完整的页面的过程，影响到这个阶段的主要因素有网络和js脚本。</li> <li>交互阶段：从页面加载完成到用户交互的整合过程，影响到的主要是 js 脚本。</li> <li>关闭阶段：从用户发出关闭指令后页面所做的一些清理操作。</li></ul> <h3 id="加载阶段"><a href="#加载阶段" class="header-anchor">#</a> 加载阶段</h3> <p>像js、css、html阻塞网页首次渲染的资源称为关键资源。而像图片、音频、视频等不会阻塞页面的首次渲染。可以细化三个影响页面首次渲染的核心因素。</p> <ul><li><p>第一个是关键资源个数。比如HTML文件、JavaScript文件和CSS文件</p></li> <li><p>第二个是关键资源大小。通常关键资源的内容越小，整个资源的下载就越短，阻塞渲染的时间也越短。</p></li> <li><p>第三个是请求关键资源需要多少个 RTT。 使用 TCP 协议传输一个文件时，由于TCP的特性，这个数据是被拆分为一个个的数据包来回多次进行传输的。RTT就是往返时延。表示从发送端发送数据开始，返回数据共经历的时延。通常1个HTTP的数据包在14KB左右，以一个0.1M的页面就需要拆分为8个包传递，也就是8个RTT。</p></li></ul> <p>那么如何针对性的解决呢？</p> <ul><li><p>将 js 和 css 改成内联形式。可以减少文件个数。如果js1没有DOM或CSSOM的操作，可以改成async或defer属性。可以将不需要css给变为非关键资源。</p></li> <li><p>减少关键资源个数。 内联JavaScript和CSS。async/defer、如果不是在构建页面之前加载的CSS，可以添加媒体取消阻止显现的标志。</p></li> <li><p>减小关键资源大小？可以压缩CSS和JavaScript资源，移除 HTML、CSS、JavaScript 文件中一些注释内容。</p></li> <li><p>减少RTT次数。 就是减少关键资源的个数和大小。 还可以使用 CDN减少RTT时长。</p></li></ul> <h3 id="交互阶段"><a href="#交互阶段" class="header-anchor">#</a> 交互阶段</h3> <p>这个过程其实就是渲染进程渲染帧的速度，帧的渲染速度决定了交互的流畅度。</p> <p>这个阶段就主要是一帧的生成，大部分情况下，生成一个新的帧都是由js通过由js修改修改DOM或者CSSOM来触发的。</p> <p>交互阶段没有加载关键资源和构建DOM、CSSOM的流程，通常是由 JavaScript 触发交互动画的。</p> <p>一方面就是布局信息的修改，就会触发重排操作。然后出发后续渲染流水线的一系列操作。</p> <p>一方面就是修改了颜色一类的信息，那么就不会涉及到布局相关的调整，可以跳过布局极端，直接进入绘制阶段。</p> <p>另一个方面就是通过 CSS 实现一些变形、渐变、动画等特效，由CSS触发的，并且是在合成线程上执行的，这个过程称为合成。不会触发重排或者重绘。</p> <p>目标就是如何让单帧的生成速度变快。</p> <ol><li><p>减少 js 脚本的执行时间(占据主线程时间太长), 比如一个函数一次执行要花费很长时间，严重占了主线程执行其他渲染任务的时间。</p> <ul><li>可以将一次性操作函数分解为多个任务，每个任务都不会太久。</li> <li>采用 Web Workers。 是主线程之外的另一个线程，可以执行 js 脚本，但是没有 DOM、CSSOM 环境。无法访问 DOM 的操作。可以将一些耗时的任务放到 Web Workers 中执行。</li></ul></li> <li><p>避免强制同步布局
指 js 强制将计算样式和布局操作提前放到当前任务重。</p></li></ol> <p>重新获取高度，需要重新布局，在获取高度之前，js还需要强制让渲染引擎执行一次布局操作。 导致计算样式和布局都在当前脚本执行过程中触发。</p> <p>我们可以进程调整，在修改 DOM 之前查询相关值。</p> <ol start="3"><li>避免布局抖动
在一次 js 执行过程中，多次执行强制布局和抖动操作。</li></ol> <p>比如 for 循环中，不断读取属性值，每次读取属性值之前都要进行样式计算和布局。大大影响当前函数的执行效率。</p> <p>尽量不要在修改 DOM 结构时再去查询一些相关值。</p> <ol start="4"><li>合理利用 CSS 合成动画。
尽量使用 CSS 合成动画，能让 CSS 处理动画，尽量让 CSS 操作。</li></ol> <p>如果提前知道某个元素执行动画操作，最好标记为 will-change，告诉渲染引擎将该元素单独生成一个图层。</p> <ol start="5"><li>避免频繁的垃圾回收
在一些函数中频繁创建临时对象，那么垃圾回收也会频繁的执行垃圾回收策略。会占用主线程，影响到其他任务的执行。</li></ol> <p>尽可能的优化存储结构，避免小颗粒对象产生。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/browser/componentDocs/v8对数组的优化.html" class="prev">
        V8数组的动态扩容以及对数组优化
      </a></span> <span class="next"><a href="/browser/componentDocs/Chrome的Audits面板.html">
        Chrome的Audits面板
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/browser/assets/js/app.9d8b2b9f.js" defer></script><script src="/browser/assets/js/2.c6ab72a1.js" defer></script><script src="/browser/assets/js/23.58ff0792.js" defer></script>
  </body>
</html>
