<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器执行原理 | 浏览器</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/browser/assets/css/0.styles.a14fe33a.css" as="style"><link rel="preload" href="/browser/assets/js/app.9d8b2b9f.js" as="script"><link rel="preload" href="/browser/assets/js/2.c6ab72a1.js" as="script"><link rel="preload" href="/browser/assets/js/34.5d801168.js" as="script"><link rel="prefetch" href="/browser/assets/js/10.585245e1.js"><link rel="prefetch" href="/browser/assets/js/11.5aae5444.js"><link rel="prefetch" href="/browser/assets/js/12.71269f1a.js"><link rel="prefetch" href="/browser/assets/js/13.0a7f30a4.js"><link rel="prefetch" href="/browser/assets/js/14.45a1a3a7.js"><link rel="prefetch" href="/browser/assets/js/15.ed81d5cf.js"><link rel="prefetch" href="/browser/assets/js/16.cc7e2e9b.js"><link rel="prefetch" href="/browser/assets/js/17.db4ea61b.js"><link rel="prefetch" href="/browser/assets/js/18.e3ae8c8b.js"><link rel="prefetch" href="/browser/assets/js/19.bfba4f3f.js"><link rel="prefetch" href="/browser/assets/js/20.c6b94b86.js"><link rel="prefetch" href="/browser/assets/js/21.1e59a022.js"><link rel="prefetch" href="/browser/assets/js/22.654197cf.js"><link rel="prefetch" href="/browser/assets/js/23.58ff0792.js"><link rel="prefetch" href="/browser/assets/js/24.aea860a9.js"><link rel="prefetch" href="/browser/assets/js/25.26a87bae.js"><link rel="prefetch" href="/browser/assets/js/26.00a97756.js"><link rel="prefetch" href="/browser/assets/js/27.d3683b0a.js"><link rel="prefetch" href="/browser/assets/js/28.deb80b65.js"><link rel="prefetch" href="/browser/assets/js/29.9ad843c1.js"><link rel="prefetch" href="/browser/assets/js/3.2ac56f48.js"><link rel="prefetch" href="/browser/assets/js/30.707d3269.js"><link rel="prefetch" href="/browser/assets/js/31.3c38d117.js"><link rel="prefetch" href="/browser/assets/js/32.c449df23.js"><link rel="prefetch" href="/browser/assets/js/33.608e131b.js"><link rel="prefetch" href="/browser/assets/js/35.e0ef97a3.js"><link rel="prefetch" href="/browser/assets/js/36.12fa7af7.js"><link rel="prefetch" href="/browser/assets/js/37.b611c7e3.js"><link rel="prefetch" href="/browser/assets/js/38.5adc6f54.js"><link rel="prefetch" href="/browser/assets/js/39.eafb2e3f.js"><link rel="prefetch" href="/browser/assets/js/4.b7d0708f.js"><link rel="prefetch" href="/browser/assets/js/40.e1d0ac06.js"><link rel="prefetch" href="/browser/assets/js/41.bff30e89.js"><link rel="prefetch" href="/browser/assets/js/42.f57de2b4.js"><link rel="prefetch" href="/browser/assets/js/43.3eb2033e.js"><link rel="prefetch" href="/browser/assets/js/44.7049f3ae.js"><link rel="prefetch" href="/browser/assets/js/45.560dd0fe.js"><link rel="prefetch" href="/browser/assets/js/46.61f9c03b.js"><link rel="prefetch" href="/browser/assets/js/47.343cd03f.js"><link rel="prefetch" href="/browser/assets/js/48.6eaca372.js"><link rel="prefetch" href="/browser/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/browser/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/browser/assets/js/7.8a5eaf01.js"><link rel="prefetch" href="/browser/assets/js/8.c4154854.js"><link rel="prefetch" href="/browser/assets/js/9.400f3a74.js">
    <link rel="stylesheet" href="/browser/assets/css/0.styles.a14fe33a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/browser/" class="home-link router-link-active"><!----> <span class="site-name">浏览器</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/browser/" class="nav-link">
  html
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/browser/" class="nav-link">
  html
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/browser/componentDocs/Chrome架构.html" class="sidebar-link">Chrome 架构</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 网络.html" class="sidebar-link">输入URL到加载经历了什么 --- 网络</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 解析.html" class="sidebar-link">输入URL到加载经历了什么 --- 解析</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 渲染.html" class="sidebar-link">输入URL到加载经历了什么 --- 渲染</a></li><li><a href="/browser/componentDocs/同一站点.html" class="sidebar-link">同一站点(输入URL网络篇补充)</a></li><li><a href="/browser/componentDocs/回流.html" class="sidebar-link">重排、重绘和合成</a></li><li><a href="/browser/componentDocs/阻塞.html" class="sidebar-link">从渲染流水线看html、css、JavaScript的阻塞</a></li><li><a href="/browser/componentDocs/defer、async.html" class="sidebar-link">defer、async（阻塞章节优化JavaScript点）</a></li><li><a href="/browser/componentDocs/DOM树构建过程.html" class="sidebar-link">DOM树构建过程</a></li><li><a href="/browser/componentDocs/浏览器缓存.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/browser/componentDocs/浏览器页面如何工作.html" class="sidebar-link">浏览器页面如何工作</a></li><li><a href="/browser/componentDocs/页面生命周期.html" class="sidebar-link">页面生命周期</a></li><li><a href="/browser/componentDocs/跨域解决.html" class="sidebar-link">跨域解决方案</a></li><li><a href="/browser/componentDocs/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/browser/componentDocs/内存泄露.html" class="sidebar-link">内存泄露</a></li><li><a href="/browser/componentDocs/前端存储.html" class="sidebar-link">前端存储</a></li><li><a href="/browser/componentDocs/存储超过限制.html" class="sidebar-link">存储超过限制</a></li><li><a href="/browser/componentDocs/识别浏览器类型.html" class="sidebar-link">识别浏览器类型</a></li><li><a href="/browser/componentDocs/外部资源的加载事件.html" class="sidebar-link">资源加载</a></li><li><a href="/browser/componentDocs/Chrome开发者工具.html" class="sidebar-link">Chrome开发者工具</a></li><li><a href="/browser/componentDocs/网络面板.html" class="sidebar-link">网络面板</a></li><li><a href="/browser/componentDocs/首屏优化.html" class="sidebar-link">首屏加载</a></li><li><a href="/browser/componentDocs/CSS动画和JS动画.html" class="sidebar-link">CSS动画和JavaScript动画</a></li><li><a href="/browser/componentDocs/CDN.html" class="sidebar-link">CDN</a></li><li><a href="/browser/componentDocs/资源优化.html" class="sidebar-link">资源优化</a></li><li><a href="/browser/componentDocs/浏览器安全.html" class="sidebar-link">浏览器安全</a></li><li><a href="/browser/componentDocs/XSS攻击.html" class="sidebar-link">XSS 攻击</a></li><li><a href="/browser/componentDocs/CSRF 攻击.html" class="sidebar-link">CSRF 攻击</a></li><li><a href="/browser/componentDocs/浏览器内核与引擎.html" class="sidebar-link">浏览器内核与引擎</a></li><li><a href="/browser/componentDocs/V8执行原理和优化策略.html" class="sidebar-link">JavaScriot(V8) 执行原理</a></li><li><a href="/browser/componentDocs/V8优化小知识点.html" class="sidebar-link">V8优化小知识点</a></li><li><a href="/browser/componentDocs/v8对数组的优化.html" class="sidebar-link">V8数组的动态扩容以及对数组优化</a></li><li><a href="/browser/componentDocs/从Chrome渲染一帧的角度来做优化.html" class="sidebar-link">从Chrome渲染一帧的角度来做优化</a></li><li><a href="/browser/componentDocs/Chrome的Audits面板.html" class="sidebar-link">Chrome的Audits面板</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器执行原理"><a href="#浏览器执行原理" class="header-anchor">#</a> 浏览器执行原理</h1> <p>从输入URL到页面加载，就可以看到页面的渲染过程。</p> <h3 id="浏览器的主要构成部分"><a href="#浏览器的主要构成部分" class="header-anchor">#</a> 浏览器的主要构成部分</h3> <ul><li>用户界面</li> <li>浏览器引擎</li> <li>渲染引擎(内核)</li> <li>JS引擎</li></ul> <h3 id="渲染引擎-浏览器内核、浏览器引擎"><a href="#渲染引擎-浏览器内核、浏览器引擎" class="header-anchor">#</a> 渲染引擎(浏览器内核、浏览器引擎)</h3> <ul><li>Trident: IE4-IE11,  Edge是用的Blink</li> <li>Gecko: Firefox</li> <li>Webkit: 苹果基于KHTML开发, Safari、Google之前也在使用 Webkit</li> <li>Blink: 是 Webkit 的一个分支，由 Google 开发，现应用于 Google、Edge、Opera 等</li></ul> <h3 id="js-引擎"><a href="#js-引擎" class="header-anchor">#</a> JS 引擎</h3> <p>编写的 JS，实际上是需要被 CPU 执行的；CPU 只认识自己的指令集（机器语言）</p> <ul><li>SpiderMonkey: js作者开发。</li> <li>Chakra: 微软开发，IE。</li> <li>JavaScriptCore: Webkit中内置的，Apple公司开发。</li> <li>V8: Google开发的js引擎。
...</li></ul> <h3 id="浏览器内核和js引擎的关系"><a href="#浏览器内核和js引擎的关系" class="header-anchor">#</a> 浏览器内核和JS引擎的关系</h3> <p>以 WebKit 为例，WebKie主要由两部分组成</p> <ul><li>WebCore: 负责HTML解析、布局、渲染等相关工作</li> <li>JavaScriptCore: 解析、执行JS代码</li></ul> <h3 id="v8引擎"><a href="#v8引擎" class="header-anchor">#</a> V8引擎</h3> <p>V8是用C++编写的Google开源高性能JS和WebAssembly引擎，用于Chrome和Node等, 实现ECMAScript.
V8可以独立运行，也可以潜入到C++应用程序中。</p> <h3 id="v8架构图"><a href="#v8架构图" class="header-anchor">#</a> V8架构图</h3> <img src="/browser/v8.png" width="800" height="500"> <ol><li>进行词法分析和语法分析:</li></ol> <ul><li>词法分析 tokens  [{type: 'keyword', name: 'foo'}, {type: '关键字', name: 'for'}]</li> <li>语法分析 分析语法结构</li></ul> <ol start="2"><li><p>AST树 Tokens 经过Parser和PreParser, 会被转为 AST 树</p></li> <li><p>转为字节码
因为 JS 作用的环境不一定；windows/mac/linux 的浏览器上面；跑在不同的环境有不同的CPU架构；能够执行的机器指令是不一样的；V8会将字节码转为不同平台的机器码</p></li> <li><p>TuboFan 来收集执行信息, 标记 hot 热点代码, 标记为 hot 之后，可以直接转为高效率的机器码</p></li> <li><p>Deoptimization 反优化，会将机器指令重新编译为字节码；</p></li></ol> <h3 id="js如何被执行"><a href="#js如何被执行" class="header-anchor">#</a> JS如何被执行</h3> <ol><li>Parse 解析的时候就会创建一个 GlobalObject(GO) = {}</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> globalObject <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">String</span><span class="token operator">:</span> <span class="token string">&quot;类&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">Date</span><span class="token operator">:</span> <span class="token string">'类'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">setTimeout</span><span class="token operator">:</span> <span class="token string">&quot;函数&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">window</span><span class="token operator">:</span> globalObject<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>代码如何被运行
V8需要将代码放置到执行上下文中运行; 为了全局代码能够正常的执行，会创建一个全局上下文</li></ol> <p>当前上下文的 VO 变量对象会指向 GO； 执行代码通过 VO 找到 GO，修改 GO 的值</p> <ol start="3"><li>函数如何执行
编译到函数，并不会执行，而是先会开辟一块内存空, GlobalObject 的 foo 指向内存地址；内存地址包括函数的执行代码块和[[scope]]: parent scope</li></ol> <p>执行函数，会在上下文栈中先创建一个函数执行上下文,FEC；当前上下文的 VO 变量对象会指向 AO 对象(Activation Object活跃对象：来收集函数内部参数变量)。</p> <p>然后执行代码，去 VO 去查找变量；执行完之后就会出栈；对应 AO 也会被销毁</p> <p>函数在激活后有 scope chain: VO + parent scope 就是作用域链</p> <ol start="4"><li>AO环境</li></ol> <ul><li>ES5之前说法
每创建一个执行上下文都会关联到变量对象上VO， 声明变量或函数会作为属性添加到VO上,参数也会被添加到VO上.</li> <li>ES5之后说法
每创建一个执行上下文都会关联到变量环境中，在执行代码中变量和函数的声明会作为环境记录添加到变量环境中。</li></ul> <h3 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h3> <ol><li>维基百科</li></ol> <ul><li>是在支持头等函数的编程语言中，实现词法绑定的一种技术；</li> <li>闭包在实现上是一个结构体，它存储了一个函数和一个关联环境</li> <li>闭包跟函数最大的区别在于，当捕捉闭包的时候，它的自由变量会在捕捉时被确定，这样即使脱离了捕捉时的上下文，它也能照常运行。</li></ul> <ol start="2"><li>MDN</li></ol> <ul><li>一个函数和对其周围状态（词法环境）的引用绑在一起（或者说函数被引用包围），这样的组合就是闭包。</li> <li>闭包让你可以在一个内层函数中访问到外层函数的作用域;</li> <li>在 js 中，每当创建一个函数，闭包就会在函数创建的同时被创建出来</li></ul> <ol start="3"><li>总结</li></ol> <ul><li>一个普通的函数，如果它可以访问外层作用域的自由变量，那么这个函数就是一个闭包。</li> <li>广义上讲：js的函数都是闭包</li> <li>狭义上讲：js中一个函数，如果访问了外层作用域的变量，那么它就是一个闭包。</li></ul> <h3 id="闭包内存图"><a href="#闭包内存图" class="header-anchor">#</a> 闭包内存图</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li>执行栈中：全局执行上下文、函数执行上下文 foo； 堆内存图中：GO对象(0xa00); foo(0x100)parentScope，执行题； AO: 0x200；</li></ol> <p>函数执行上下文 foo 指向 AO(0x200) 全局执行上下文指向GO(0xa00)</p> <img src="/browser/v8.png" width="800" height="500"> <ol start="2"><li>foo出栈，AO(0x200)销毁； 剩余 GO(0xa00)、foo(0x100)
<img src="/browser/v8.png" width="800" height="500"></li></ol> <hr> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bar
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><p>GO(0xa00)、foo(0x100)、foo VO(0xa00)、bar(0x200)、bar VO(0xb00)
<img src="/browser/v8.png" width="800" height="500"></p></li> <li><p>GO(0xa00)、foo(0x100)、foo VO(0xa00)、bar(0x200)parentScope: parentScope(0xa00)
fn(0x200)</p></li></ol> <img src="/browser/v8.png" width="800" height="500"> <ol start="3"><li>fn = null 释放对bar(0x200)的释放、foo VO(0xa00)得到释放，foo = null 释放对foo(0x100)释放
<img src="/browser/v8.png" width="800" height="500"></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/browser/assets/js/app.9d8b2b9f.js" defer></script><script src="/browser/assets/js/2.c6ab72a1.js" defer></script><script src="/browser/assets/js/34.5d801168.js" defer></script>
  </body>
</html>
