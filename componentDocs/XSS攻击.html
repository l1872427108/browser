<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XSS 攻击 | 浏览器</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/browser/assets/css/0.styles.a14fe33a.css" as="style"><link rel="preload" href="/browser/assets/js/app.9d8b2b9f.js" as="script"><link rel="preload" href="/browser/assets/js/2.c6ab72a1.js" as="script"><link rel="preload" href="/browser/assets/js/19.bfba4f3f.js" as="script"><link rel="prefetch" href="/browser/assets/js/10.585245e1.js"><link rel="prefetch" href="/browser/assets/js/11.5aae5444.js"><link rel="prefetch" href="/browser/assets/js/12.71269f1a.js"><link rel="prefetch" href="/browser/assets/js/13.0a7f30a4.js"><link rel="prefetch" href="/browser/assets/js/14.45a1a3a7.js"><link rel="prefetch" href="/browser/assets/js/15.ed81d5cf.js"><link rel="prefetch" href="/browser/assets/js/16.cc7e2e9b.js"><link rel="prefetch" href="/browser/assets/js/17.db4ea61b.js"><link rel="prefetch" href="/browser/assets/js/18.e3ae8c8b.js"><link rel="prefetch" href="/browser/assets/js/20.c6b94b86.js"><link rel="prefetch" href="/browser/assets/js/21.1e59a022.js"><link rel="prefetch" href="/browser/assets/js/22.654197cf.js"><link rel="prefetch" href="/browser/assets/js/23.58ff0792.js"><link rel="prefetch" href="/browser/assets/js/24.aea860a9.js"><link rel="prefetch" href="/browser/assets/js/25.26a87bae.js"><link rel="prefetch" href="/browser/assets/js/26.00a97756.js"><link rel="prefetch" href="/browser/assets/js/27.d3683b0a.js"><link rel="prefetch" href="/browser/assets/js/28.deb80b65.js"><link rel="prefetch" href="/browser/assets/js/29.9ad843c1.js"><link rel="prefetch" href="/browser/assets/js/3.2ac56f48.js"><link rel="prefetch" href="/browser/assets/js/30.707d3269.js"><link rel="prefetch" href="/browser/assets/js/31.3c38d117.js"><link rel="prefetch" href="/browser/assets/js/32.c449df23.js"><link rel="prefetch" href="/browser/assets/js/33.608e131b.js"><link rel="prefetch" href="/browser/assets/js/34.5d801168.js"><link rel="prefetch" href="/browser/assets/js/35.e0ef97a3.js"><link rel="prefetch" href="/browser/assets/js/36.12fa7af7.js"><link rel="prefetch" href="/browser/assets/js/37.b611c7e3.js"><link rel="prefetch" href="/browser/assets/js/38.5adc6f54.js"><link rel="prefetch" href="/browser/assets/js/39.eafb2e3f.js"><link rel="prefetch" href="/browser/assets/js/4.b7d0708f.js"><link rel="prefetch" href="/browser/assets/js/40.e1d0ac06.js"><link rel="prefetch" href="/browser/assets/js/41.bff30e89.js"><link rel="prefetch" href="/browser/assets/js/42.f57de2b4.js"><link rel="prefetch" href="/browser/assets/js/43.3eb2033e.js"><link rel="prefetch" href="/browser/assets/js/44.7049f3ae.js"><link rel="prefetch" href="/browser/assets/js/45.560dd0fe.js"><link rel="prefetch" href="/browser/assets/js/46.61f9c03b.js"><link rel="prefetch" href="/browser/assets/js/47.343cd03f.js"><link rel="prefetch" href="/browser/assets/js/48.6eaca372.js"><link rel="prefetch" href="/browser/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/browser/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/browser/assets/js/7.8a5eaf01.js"><link rel="prefetch" href="/browser/assets/js/8.c4154854.js"><link rel="prefetch" href="/browser/assets/js/9.400f3a74.js">
    <link rel="stylesheet" href="/browser/assets/css/0.styles.a14fe33a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/browser/" class="home-link router-link-active"><!----> <span class="site-name">浏览器</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/browser/" class="nav-link">
  html
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/browser/" class="nav-link">
  html
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/browser/componentDocs/Chrome架构.html" class="sidebar-link">Chrome 架构</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 网络.html" class="sidebar-link">输入URL到加载经历了什么 --- 网络</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 解析.html" class="sidebar-link">输入URL到加载经历了什么 --- 解析</a></li><li><a href="/browser/componentDocs/输入URL到加载经历了什么 --- 渲染.html" class="sidebar-link">输入URL到加载经历了什么 --- 渲染</a></li><li><a href="/browser/componentDocs/同一站点.html" class="sidebar-link">同一站点(输入URL网络篇补充)</a></li><li><a href="/browser/componentDocs/回流.html" class="sidebar-link">重排、重绘和合成</a></li><li><a href="/browser/componentDocs/阻塞.html" class="sidebar-link">从渲染流水线看html、css、JavaScript的阻塞</a></li><li><a href="/browser/componentDocs/defer、async.html" class="sidebar-link">defer、async（阻塞章节优化JavaScript点）</a></li><li><a href="/browser/componentDocs/DOM树构建过程.html" class="sidebar-link">DOM树构建过程</a></li><li><a href="/browser/componentDocs/浏览器缓存.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/browser/componentDocs/浏览器页面如何工作.html" class="sidebar-link">浏览器页面如何工作</a></li><li><a href="/browser/componentDocs/页面生命周期.html" class="sidebar-link">页面生命周期</a></li><li><a href="/browser/componentDocs/跨域解决.html" class="sidebar-link">跨域解决方案</a></li><li><a href="/browser/componentDocs/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/browser/componentDocs/内存泄露.html" class="sidebar-link">内存泄露</a></li><li><a href="/browser/componentDocs/前端存储.html" class="sidebar-link">前端存储</a></li><li><a href="/browser/componentDocs/存储超过限制.html" class="sidebar-link">存储超过限制</a></li><li><a href="/browser/componentDocs/识别浏览器类型.html" class="sidebar-link">识别浏览器类型</a></li><li><a href="/browser/componentDocs/外部资源的加载事件.html" class="sidebar-link">资源加载</a></li><li><a href="/browser/componentDocs/Chrome开发者工具.html" class="sidebar-link">Chrome开发者工具</a></li><li><a href="/browser/componentDocs/网络面板.html" class="sidebar-link">网络面板</a></li><li><a href="/browser/componentDocs/首屏优化.html" class="sidebar-link">首屏加载</a></li><li><a href="/browser/componentDocs/CSS动画和JS动画.html" class="sidebar-link">CSS动画和JavaScript动画</a></li><li><a href="/browser/componentDocs/CDN.html" class="sidebar-link">CDN</a></li><li><a href="/browser/componentDocs/资源优化.html" class="sidebar-link">资源优化</a></li><li><a href="/browser/componentDocs/浏览器安全.html" class="sidebar-link">浏览器安全</a></li><li><a href="/browser/componentDocs/XSS攻击.html" class="active sidebar-link">XSS 攻击</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/browser/componentDocs/XSS攻击.html#可以完成的操作" class="sidebar-link">可以完成的操作</a></li><li class="sidebar-sub-header"><a href="/browser/componentDocs/XSS攻击.html#存储型" class="sidebar-link">存储型</a></li><li class="sidebar-sub-header"><a href="/browser/componentDocs/XSS攻击.html#反射型" class="sidebar-link">反射型</a></li><li class="sidebar-sub-header"><a href="/browser/componentDocs/XSS攻击.html#文档型-基于-dom-的-xss-攻击" class="sidebar-link">文档型(基于 DOM 的 XSS 攻击)</a></li><li class="sidebar-sub-header"><a href="/browser/componentDocs/XSS攻击.html#措施" class="sidebar-link">措施</a></li></ul></li><li><a href="/browser/componentDocs/CSRF 攻击.html" class="sidebar-link">CSRF 攻击</a></li><li><a href="/browser/componentDocs/浏览器内核与引擎.html" class="sidebar-link">浏览器内核与引擎</a></li><li><a href="/browser/componentDocs/V8执行原理和优化策略.html" class="sidebar-link">JavaScriot(V8) 执行原理</a></li><li><a href="/browser/componentDocs/V8优化小知识点.html" class="sidebar-link">V8优化小知识点</a></li><li><a href="/browser/componentDocs/v8对数组的优化.html" class="sidebar-link">V8数组的动态扩容以及对数组优化</a></li><li><a href="/browser/componentDocs/从Chrome渲染一帧的角度来做优化.html" class="sidebar-link">从Chrome渲染一帧的角度来做优化</a></li><li><a href="/browser/componentDocs/Chrome的Audits面板.html" class="sidebar-link">Chrome的Audits面板</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="xss-攻击"><a href="#xss-攻击" class="header-anchor">#</a> XSS 攻击</h1> <p>XSS 全称 Cross Site Scripting(跨站脚本), 为了和 CSS 区分，才叫做 XSS。XSS 攻击时指浏览器中执行恶意脚本（无论是跨域还是同域），从而拿到用户的信息并进行操作。</p> <h2 id="可以完成的操作"><a href="#可以完成的操作" class="header-anchor">#</a> 可以完成的操作</h2> <ol><li>窃取 Cookie. 通过 document.cookie 获取信息。然后通过 XMLHttpRequest 或者 Fetch 加上 CORS 功能将数据发送给恶意服务器。</li> <li>监听用户行为，可以使用 addEventListener 接口来监听键盘事件，比如可以获取用户输入的信用卡信息，将其发送给恶意服务器。</li> <li>修改 DOM 伪造登录表单， 用来欺骗用户名和密码等信息。</li> <li>在页面中生成浮动窗口广告。严重影响用户体验。</li></ol> <p>如果页面插入了恶意脚本，就相当于把我们的页面的隐私数据和行为完全暴露给黑客了。</p> <p>只有知道了有哪些注入方式，才能够更好的预防。XSS 攻击实现有三种方式 --- 存储型、反射型 和 文档型。</p> <h2 id="存储型"><a href="#存储型" class="header-anchor">#</a> 存储型</h2> <p>存储型，就是将恶意脚本存储起来，存储型的 XSS 将脚本存储到服务端的数据库，然后在客户端执行这些脚本，从而达到攻击的效果。</p> <p>步骤：</p> <ul><li>黑客利用站点漏洞将恶意 js 提交到网站的数据库中。</li> <li>用户请求包含恶意 js 脚本的页面。</li> <li>当用户浏览该页面的时，恶意脚本将用户 cookie 等上传到服务器。</li></ul> <p>常见的场景是留言评论区提交一段脚本代码，如果前后端没有做好转义工作，那评论就会拿到数据库，在页面渲染的过程中直接执行一段未知的逻辑，是非常恐怖的。</p> <p>2015年喜马拉雅就被曝出了存储型 XSS 漏洞。 起因是在用户设置专辑名称时，服务器对关键字过滤不严格，比如设置为一段js脚本。当提交后，喜马拉雅服务器保存该字段到数据库。当用户打开后，这段代码在用户的页面执行，就可以获取用户 Cookie。 恶意脚本可以通过 XML 或 Fetch 将用户的 Cookie 数据上传到黑客的服务器。拿到之后就可以伪造用户上网。</p> <h2 id="反射型"><a href="#反射型" class="header-anchor">#</a> 反射型</h2> <p>在一个反射型 XSS 攻击过程中，恶意 JavaScript 脚本属于用户发送给网站请求中的一部分，随后网站又把恶意 JavaScript 脚本返回给用户。当恶意 JavaScript 脚本在用户页面中被执行时，黑客就可以利用该脚本做一些恶意操作。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3000</span><span class="token operator">/</span><span class="token operator">?</span>xss<span class="token operator">=</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'你被劫持了'</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>通过这个操作，用户将一段含有恶意代码的请求提交给Web服务器，Web服务器接收到请求时，将恶意代码反射给浏览器端，这就是反射XSS攻击。</p> <p>黑客经常会通过QQ群或者邮件等渠道诱导用户去点击这些恶意链接。</p> <p>Web 服务器不会存储这些恶意脚本。</p> <h2 id="文档型-基于-dom-的-xss-攻击"><a href="#文档型-基于-dom-的-xss-攻击" class="header-anchor">#</a> 文档型(基于 DOM 的 XSS 攻击)</h2> <p>基于 DOM 的 XSS 攻击是不牵涉到页面 Web 服务器的。
文档型的 XSS 攻击不会经过 服务端，而是作为中间人的角色，在数据传输过程劫持到网络数据包，然后修改里面的 html 文档。</p> <p>黑客通过各种手段将恶意脚本注入用户的页面中，比如通过网络劫持在页面传输过程中修改 HTML 页面的内容，这种劫持类型很多，有通过 WiFi 路由器劫持的，有通过本地恶意软件来劫持的，它们的共同点是在 Web 资源传输过程或者在用户使用页面的过程中修改 Web 页面的数据。</p> <p>这样的劫持方式包括： WIFI 路由劫持 或者 本地恶意软件 等.</p> <h2 id="措施"><a href="#措施" class="header-anchor">#</a> 措施</h2> <p>存储型XSS攻击和反射型XSS攻击都是需要经过Web服务器处理的，这两种可以认为是服务器端漏洞。而基于DOM的XSS攻击时在浏览器端完成的，属于是前端的安全漏洞。</p> <p>共同点都是往浏览器中注入恶意脚本，然后再通过恶意脚本将用户信息发送到黑客部署的服务器上。</p> <p>通过阻止恶意 JavaScript 脚本的注入和恶意消息的发送来实现。</p> <ol><li>服务器对输入脚本进行过滤或转码
不管是反射型还是存储型 XSS 攻击， 我们都可以在服务器端将一些关键的字符进行转码</li></ol> <p>过滤掉标签或者是转移 &lt;script&gt;</p> <ol start="2"><li>利用 CSP
完全依靠服务器端是不够的，还需要把CSP等策略充分利用起来，降低XSS攻击带来的风险。
CSP 是浏览器的内容安全策略，核心思想就是服务器来决定浏览器加载哪些资源。</li></ol> <ul><li>限制加载其他域下的资源文件，这样即使黑客插入一个js文件，也是我无法加载的。</li> <li>禁止向第三方域提交数据，数据就不会泄露。</li> <li>禁止执行内联脚本和未授权的脚本</li> <li>提供上报机制，帮助及时发现 XSS 攻击。</li></ul> <ol start="3"><li>利用 HttpOnly
很多 XSS 攻击脚本都是用来读取 Cookie 的，而设置 Cookie 的 HttpOnly 属性后， js 便无法读取 Cookie 的值，很好的防御 XSS 攻击。</li></ol> <p>通过服务器可以将某些 Cookie 设置为 HttpOnly 标志，HttpOnly 是服务器通过 HTTP 响应头来设置的。</p> <div class="language- extra-class"><pre class="language-text"><code>set-cookie: NID=189=M8q2jUx...; path=/;domain=.puge.cn;HttpOnly
</code></pre></div><p>set-cookie 属性值最后使用了 HttpOnly 来标记该 Cookie, 用 HttpOnly 标记的 Cookie 只能使用在 HTTP 请求过程中，所以无法通过 JavaScript 来读取这段 Cookie。</p> <p>NID 这个 Cookie 的 HttpOlny 属性是被勾选上的，所以 NID 的内容是无法通过 document.cookie 是来读取的。</p> <h3 id="跨站攻击-前端承担的责任大吗"><a href="#跨站攻击-前端承担的责任大吗" class="header-anchor">#</a> 跨站攻击，前端承担的责任大吗</h3> <p>对于三种方式：DOM攻击可以归属于前端，但是属于浏览器插件，传输过程中被串改，权限要大，直接修改东西。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/browser/componentDocs/浏览器安全.html" class="prev">
        浏览器安全
      </a></span> <span class="next"><a href="/browser/componentDocs/CSRF 攻击.html">
        CSRF 攻击
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/browser/assets/js/app.9d8b2b9f.js" defer></script><script src="/browser/assets/js/2.c6ab72a1.js" defer></script><script src="/browser/assets/js/19.bfba4f3f.js" defer></script>
  </body>
</html>
